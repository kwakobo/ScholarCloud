<html>
	<head>
		<link rel="stylesheet" type="text/css" href="css/theme.css">
		<script type="text/javascript" src="sortfunctions.js"></script>
		<!-- QUINN AND TAYLOR CODE -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
		<script src="http://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
		<script type="text/javascript">
		$(function(){
			var elem = document.getElementById("myBar");
			var width = 0;
			//40 = 4 seconds 
			var id = setInterval(frame, 40);
			function frame() {
				if (width >= 100) {
					clearInterval(id);
				} else {
					width++; 
					elem.style.width = width + '%';
					elem.innerHTML = width * 1  + '%';
				}
			}
		});
		</script>
		<title>Authors</title>
	</head>
	<footer>
		<form id="search_form" method="post">
			<input type="hidden" id="word_clicked" name="word_clicked">
			<input type="hidden" id="titles" name="titles">
			<input type="hidden" id="authors" name="authors">
			<input type="hidden" id="conferences" name="conferences">
			<input type="hidden" id="frequencies" name="frequencies">
			<input type="hidden" id="pdfs" name="pdfs">
			<input type="hidden" id="bibtexs" name="bibtexs">
			<input type="submit" id="exportpdf" value="Export To PDF" formaction="export.php?form=pdf">
			<input type="submit" id="exporttxt" value="Export To Plain Text" formaction="export.php?form=txt">
		</form>
	</footer>
	<body>
		<div id="myProgress">
  			<div id="myBar">0%</div>
		</div>
		<center>
			<h1 id="title"></h1>
			<table id="table">
				<tr>
					<th>Paper</th>
					<th>Download</th>
					<th>Bibtex</th>
					<th>Frequency</th>
					<th>Authors</th>
					<th>Conference</th>
				</tr>
			</table>
		</table>
		</center>
		<script>
			function add_forms(word_chosen, titles_array, authors_array, conferences_array, frequencies_array, pdfs_array, bibtexs_array)
			{
				console.log("adding");
				document.getElementById("word_clicked").value = word_chosen;
				document.getElementById("titles").value = titles_array;
				document.getElementById("authors").value = authors_array;
				document.getElementById("conferences").value = conferences_array;
				document.getElementById("frequencies").value = frequencies_array;
				document.getElementById("pdfs").value = pdfs_array;
				document.getElementById("bibtexs").value = bibtexs_array;
			}

			// INPUT: 'William G. J. Halfond,  Alessandro Orso'
			// OUTPUT: ['William G. J. Halfond', 'Alessandro Orso']
			// NOTE: Two spaces between values
			function parse_authors(authors)
			{
				return authors.split(';  ');
			}
			function word_freq(sentence, word)
			{
				word = word.toLowerCase();
				var counter = 0;
				var text = sentence;
				var array = [];
				var index = -1;

				// replace is from wordfreq.worker.js
				text = text
					.replace(/\.+/g, '.') // replace multiple full stops
					.replace(/(.{3,})\.$/g, '$1') // replace single trailing stop
					.replace(/n[\'’]t\b/ig, '') // get rid of ~n't
					.replace(/[\'’](s|ll|d|ve)?\b/ig, '') // get rid of ’ and '
					.toLowerCase();

				do {
					index = text.indexOf(word, index + 1);
					if (index != -1) {
						array[counter++] = index;
						//i = index;
					}
				} while (index != -1);
				return counter;
			}
			function open_url(url) {
				var win = window.open(url, '_blank');
				win.focus();
			}
			document.getElementById("title").innerHTML = localStorage.word_chosen;

			var table = document.getElementById("table");
			var word_chosen = localStorage.word_chosen;
			var articles = JSON.parse(localStorage.articles);
			
			var i;

			var titles_array = [];
			var authors_array = [];
			var conferences_array = [];
			var frequencies_array = [];
			var pdfs_array = [];
			var bibtexs_array = [];

			for(i = 0; i < articles.length; i++)
			{
				// if word freq in article is 0, break
				wordfreq = word_freq(articles[i]['text'], word_chosen);
				if(wordfreq == 0)
					continue;

				// Adding to forms array
				titles_array.push(articles[i]['title']);
				authors_array.push(articles[i]['authors']);
				conferences_array.push(articles[i]['conference']);
				frequencies_array.push(wordfreq);
				pdfs_array.push(articles[i]['article']);
				bibtexs_array.push(articles[i]['bibtex']);

				var row = document.createElement("tr");
				table.appendChild(row);

				var article = document.createElement("td");
				var url = document.createElement("td");
				url.setAttribute("onclick", "open_url('" + articles[i]['article'] + "');");
				var bibtex = document.createElement("td");
				bibtex.setAttribute("onclick", "open_url('" + articles[i]['bibtex'] + "');");
				//QUINN AND TAYLOR CODE
				var frequency = document.createElement("td"); 
				var authors = document.createElement("td"); 
				var conferenceName = document.createElement("td");

				row.appendChild(article);
				row.appendChild(url);
				row.appendChild(bibtex);
				//QUINN AND TAYLOR CODE
				row.appendChild(frequency);
				row.appendChild(authors);
				row.appendChild(conferenceName);

				article.innerHTML = articles[i]['title'];
				url.innerHTML = "URL";
				bibtex.innerHTML = "bibtex";
				//QUINN AND TAYLOR CODE
				frequency.innerHTML = wordfreq;
				authors_list = parse_authors(articles[i]['authors']);
				for(j = 0; j < authors_list.length; j++)
				{
					author_href = document.createElement("a");
					authors.appendChild(author_href);
					author_href.setAttribute("href", "Need to make word cloud href");
					author_href.innerHTML = authors_list[j];
					author_break = document.createElement("br");
					authors.appendChild(author_break);
				}
				conference_href = document.createElement("a");
				conference_href.innerHTML = articles[i]['conference'];
				conference_href.setAttribute("href", "Need to make word cloud href")
				conferenceName.appendChild(conference_href);
			}

			add_forms(word_chosen, titles_array, authors_array, conferences_array, frequencies_array, pdfs_array, bibtexs_array);
		</script>
	</body>
</html>